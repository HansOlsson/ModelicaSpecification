# From the 99th Modelica Design Meeting minutes

Agreement to proceed, but details unclear and need rapid progression.
Tools should be able to handle both – either proper subset or major overlap.

A proper subset might possible – in particular the drawbacks of quoting seem acceptable.

Add the following to Modelica (seems possible in Dymola, OpenModelica, MapleSim, Wolfram SystemModeler)
```
foo()[i]  (…)[i]
foo().r   (…).r
```

Separate tasks:
* Name mapping (quoting etc)
  - Separate name-space for automatically generated variables (perhaps not quoted).
* Subset of grammar
  - No extends.
  - No package structure – or have user-defined functions with “.” in their name.
  - Have user-defined function at start; but tight time-constraint – maybe in 2nd implementation phase in Emphysis
* Annotating the source with source-location (hopefully a general solution for Modelica; also for Buildings-models generated by Python-script, CATIA kinematics, …). Not standardize too much since depends on tool-chain, but might suffice with container – saying that it is a source location, but leave details to the tool. The location should be usable by the producer of the flat Modelica (URI – or file name+line+column). LLVM have some smart variant. Unclear if we want locations on sub-expressions, and/or multiple source locations for one equation (e.g. for flow-equation based on connect-statements). Many structural parameters must be constant-folded away (e.g. conditions for unbalanced if-then-else).
* How similar is FlatModelica to Modelica:
  - Shall parameter/constant be removed in this format – since they are evaluated in other places, or kept since part of the result?
  - Can a FlatModelica model be used as base-class? Should it behave the same in that case? Easiest to first forbid.
  - Alias-elimination etc: Allowed, but not required.
  - Are we losing some information, e.g. start-value priority
  - Have “Flat Modelica” as a separate “class”?
Reorganization of Modelica Specification – combined or separate step?

How to separate FlatModelica and Modelica:
* One possibility is a special annotation; and in that case un-mangle names etc.
* Another possibility is to say “flatmodel” instead of “model” – and thus have a different grammar.

Prioritize these steps with responsible:
1.  Subset of grammar [M. Sjölund; working in Emphysis] (We already have algorithm part in Emphysis – but that is a different sub-set); might be best to have separate grammar in case it is not a full subset. Modelica grammar (current one is about LL(k)) with some removed productions – prefer to have in similar format. Also good to have proper Modelica-parser – based on exact grammar in specification.
2.  Name mapping [H. Tidefelt]. Use quoted identifiers with standardized mangling scheme.
3.  Subset of annotations [H. Olsson]. List sub-set of Modelica-annotations with specified semantics – especially the ones relevant for simulation. Others may be kept by tools. (Inline annotations for functions, vendor annotations? choices for values of components and Dialog? Experiment, HideResult, description-strings) – add source-location.
4.  How to keep additional information, like start-value priority – that otherwise might be lost in FlatModelica format. What to preserve of Modelica_Services? How to handle ModelicaStandardTables reading from files when you don’t have files?
How to work on these in a transparent way?
* Different markdown files in MCP? Separate discussion from design in separate files (only summary)? Use labels for them? Have draft pull-request for branch with discussion? Have an official fork for each MCP? Comments on files
  - Lennart to summarize what is possible for Github projects
